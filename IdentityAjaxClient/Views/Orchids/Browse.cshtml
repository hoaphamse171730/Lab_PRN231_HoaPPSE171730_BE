@{
    ViewData["Title"] = "Orchid Catalog";
}

<h2>@ViewData["Title"]</h2>

<div class="row mb-3">
    <div class="col-md-3">
        <input id="searchName" class="form-control" placeholder="Search by name…" />
    </div>
    <div class="col-md-2">
        <select id="filterCategory" class="form-select">
            <option value="">All categories</option>
        </select>
    </div>
    <div class="col-md-2">
        <input id="minPrice" type="number" step="0.01" class="form-control" placeholder="Min price" />
    </div>
    <div class="col-md-2">
        <input id="maxPrice" type="number" step="0.01" class="form-control" placeholder="Max price" />
    </div>
    <div class="col-md-1">
        <button id="btnFilter" class="btn btn-primary">Filter</button>
    </div>
</div>

<table id="tblCatalog" class="table table-hover">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Price</th>
            <th>Natural?</th>
            <th>Category</th>
            <th>Image</th>
            <th style="width:80px">Qty</th>
            <th style="width:100px">Total</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<nav>
    <ul class="pagination">
        <li class="page-item" id="prevPage"><button class="page-link">Previous</button></li>
        <li class="page-item disabled"><span class="page-link" id="pageInfo"></span></li>
        <li class="page-item" id="nextPage"><button class="page-link">Next</button></li>
    </ul>
</nav>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const ROUTES = {
          orchids: '@BusinessObjects.Shared.ApiRoutes.Orchids'
        };
        const pageSize = 2;
        let currentPage = 1, totalCount = 0;

        function loadPage(page) {
          $.get(`${ROUTES.orchids}?page=${page}&pageSize=${pageSize}`, resp => {
            const { items, totalCount: tot } = resp;
            totalCount = tot;
            renderTable(items);
            updatePagination();
          });
        }

        function renderTable(list) {
          const rows = list.map(o => `
            <tr>
              <td>${o.orchidId}</td>
              <td>${o.orchidName}</td>
              <td>${o.price.toFixed(2)}</td>
              <!-- … etc … -->
            </tr>`).join('');
          $('#tblCatalog tbody').html(rows);
        }

        function updatePagination() {
          const totalPages = Math.ceil(totalCount / pageSize);
          $('#pageInfo').text(`Page ${currentPage} of ${totalPages}`);
          $('#prevPage').toggleClass('disabled', currentPage <= 1);
          $('#nextPage').toggleClass('disabled', currentPage >= totalPages);
        }

        $('#prevPage').click(() => {
          if (currentPage > 1) {
            loadPage(--currentPage);
          }
        });
        $('#nextPage').click(() => {
          if (currentPage * pageSize < totalCount) {
            loadPage(++currentPage);
          }
        });

        // Init
        $(function(){
          loadPage(1);
        });
    </script>
}
