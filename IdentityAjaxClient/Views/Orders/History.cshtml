@{
    ViewData["Title"] = "My Orders";
}

<h2>@ViewData["Title"]</h2>

<table id="tblHistory" class="table table-striped">
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Date</th>
            <th>Status</th>
            <th>Total</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const ROUTES = { orders: '@BusinessObjects.Shared.ApiRoutes.Orders' };
        const token  = localStorage.getItem('jwt') || '';
        $.ajaxSetup({ headers: { 'Authorization': 'Bearer ' + token } });

        // Load and render
        $.get(ROUTES.orders, data => {
          const rows = data.map(o => `
            <tr>
              <td>${o.id}</td>
              <td>${new Date(o.orderDate).toLocaleString()}</td>
              <td>${o.orderStatus}</td>
              <td>$${o.totalAmount.toFixed(2)}</td>
              <td>
                <a href="/Orders/Details/${o.id}"
                   class="btn btn-sm btn-info">
                  Details
                </a>
              </td>
            </tr>`).join('');
          $('#tblHistory tbody').html(rows);
        });
    </script>
}
